steps:
  - id: 'check variables'
    name: 'bash'
    env:
      - 'TARGET_PROJECT=$_TARGET_PROJECT'
      - 'CIDR_BLOCK=$_CIDR_BLOCK'
    script: |
      if [[ -z "$TARGET_PROJECT" ]] || [[ -z "$CIDR_BLOCK" ]]; then
        echo "set TARGET_PROJECT and CIDR_BLOCK please"
        exit 1
      fi
  - id: 'tf init'
    name: 'hashicorp/terraform:1.4.6'
    entrypoint: 'sh'
    args:
      - '-c'
      - 'terraform init'
  - id: 'tf apply'
    name: 'hashicorp/terraform:1.4.6'
    entrypoint: 'sh'
    args:
      - '-c'
      - 'terraform apply --auto-approve --var="gcp_project=$_TARGET_PROJECT" --var="cidr_block=$_CIDR_BLOCK"'